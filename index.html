<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planning Applications Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f9; }
        header { background:#dc2626; color:white; padding:20px; text-align:center; }
        .container { max-width:1200px; margin:20px auto; padding:20px; background:white; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
        table { width:100%; border-collapse:collapse; margin-top:20px; }
        th, td { padding:12px; border-bottom:1px solid #ddd; text-align:left; }
        th { background:#f9fafb; }
        .btn { cursor:pointer; border:none; border-radius:5px; padding:10px 16px; }
        .btn-primary { background:#dc2626; color:white; }
        .btn-secondary { background:#6b7280; color:white; }
        .status-badge { padding:4px 8px; border-radius:5px; color:white; font-weight:bold; }
        .status-approved { background:#16a34a; }
        .status-rejected { background:#b91c1c; }
        .status-review { background:#f59e0b; }
        .status-submitted { background:#3b82f6; }
        .workflow-stage { font-weight:bold; color:#374151; }
        .hidden { display:none; }
        .nav-tab { cursor:pointer; margin-right:10px; padding:10px 20px; border-radius:5px; background:#e5e7eb; display:inline-block; }
        .nav-tab.active { background:#dc2626; color:white; }
        /* Modal */
        .modal { position:fixed; top:0; left:0; width:100%; height:100%; display:none; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
        .modal.active { display:flex; }
        .modal-content { background:white; padding:20px; border-radius:10px; max-width:500px; width:90%; }
        input, select, textarea { width:100%; padding:8px; margin:6px 0 12px 0; border-radius:5px; border:1px solid #ccc; box-sizing:border-box; }
        #tracking-result { margin-top:20px; }
        .stats { display:flex; gap:20px; margin-bottom:20px; }
        .stat-box { background:#f9fafb; padding:10px 20px; border-radius:10px; text-align:center; flex:1; }
        .stat-box h3 { margin:0 0 5px 0; }
    </style>
</head>
<body>
    <header>
        <h1>Planning Applications Dashboard</h1>
    </header>
    <div class="container">
        <div class="nav-tabs">
            <span class="nav-tab active" onclick="showTab('dashboard', event)">Dashboard</span>
            <span class="nav-tab" onclick="showTab('applications', event)">All Applications</span>
            <span class="nav-tab" onclick="showTab('track', event)">Track Application</span>
        </div>

```
    <!-- Dashboard Tab -->
    <div id="dashboard-tab">
        <div class="stats">
            <div class="stat-box">
                <h3 id="total-applications">0</h3>
                Total Applications
            </div>
            <div class="stat-box">
                <h3 id="pending-review">0</h3>
                Pending Review
            </div>
            <div class="stat-box">
                <h3 id="approved-month">0</h3>
                Approved
            </div>
        </div>
        <button class="btn btn-primary" onclick="showNewApplicationModal()">Submit New Application</button>
    </div>

    <!-- Applications Tab -->
    <div id="applications-tab" class="hidden">
        <div style="margin-top:20px;">
            <input type="text" id="search-input" placeholder="Search by Applicant, Property, or ID" onkeyup="filterApplications()">
            <select id="filter-status" onchange="filterApplications()">
                <option value="all">All Statuses</option>
                <option value="submitted">Submitted</option>
                <option value="review">Under Review</option>
                <option value="approved">Approved</option>
                <option value="rejected">Rejected</option>
            </select>
        </div>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Applicant</th>
                    <th>Property Address</th>
                    <th>Type</th>
                    <th>Submitted</th>
                    <th>Stage</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="applications-tbody"></tbody>
        </table>
    </div>

    <!-- Track Application Tab -->
    <div id="track-tab" class="hidden">
        <input type="text" id="tracking-id" placeholder="Enter Application ID">
        <button class="btn btn-primary" onclick="trackApplication()">Track</button>
        <div id="tracking-result"></div>
    </div>
</div>

<!-- New Application Modal -->
<div id="new-application-modal" class="modal">
    <div class="modal-content">
        <h2>New Planning Application</h2>
        <form onsubmit="submitApplication(event)">
            <input type="text" id="app-id" placeholder="Application ID (e.g., PA-2025-1008)" required>
            <input type="text" id="applicant-name" placeholder="Applicant Name" required>
            <input type="text" id="property-address" placeholder="Property Address" required>
            <select id="app-type" required>
                <option value="">Select Application Type</option>
                <option value="Renovation">Renovation</option>
                <option value="New Construction">New Construction</option>
                <option value="Change of Use">Change of Use</option>
                <option value="Demolition">Demolition</option>
                <option value="Subdivision">Subdivision</option>
            </select>
            <textarea id="description" placeholder="Brief Description" required></textarea>
            <input type="date" id="submit-date" required>
            <input type="email" id="contact-email" placeholder="Contact Email" required>
            <button type="submit" class="btn btn-primary">Submit</button>
            <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        </form>
    </div>
</div>

<script>
    let applications = JSON.parse(localStorage.getItem('planning_applications')) || [
        { id:1, appId:'PA-2024-1001', applicantName:'Sarah Johnson', propertyAddress:'45 South Road, Paget', appType:'Renovation', description:'Two-story addition to existing residence', submitDate:'2024-11-01', status:'review', currentStage:'Conservation', contactEmail:'sjohnson@email.bm'},
        { id:2, appId:'PA-2024-1002', applicantName:'Michael Chen', propertyAddress:'12 Harbour Road, Hamilton', appType:'New Construction', description:'Commercial office building - 3 stories', submitDate:'2024-11-10', status:'submitted', currentStage:'Initial Review', contactEmail:'mchen@realty.bm'},
        { id:3, appId:'PA-2024-1003', applicantName:'Emily Thompson', propertyAddress:'78 Middle Road, Southampton', appType:'Change of Use', description:'Convert residential to commercial retail', submitDate:'2024-10-15', status:'approved', currentStage:'Completed', contactEmail:'ethompson@email.bm'}
    ];

    function calculateDaysSince(date){
        const diffTime = new Date() - new Date(date);
        return Math.ceil(diffTime/(1000*60*60*24));
    }

    function renderApplications(appsToRender=applications){
        const tbody = document.getElementById('applications-tbody');
        tbody.innerHTML='';
        appsToRender.forEach(app=>{
            const days=calculateDaysSince(app.submitDate);
            const statusClass=app.status==='approved'?'status-approved':app.status==='rejected'?'status-rejected':app.status==='review'?'status-review':'status-submitted';
            const statusText=app.status==='approved'?'Approved':app.status==='rejected'?'Rejected':app.status==='review'?'Under Review':'Submitted';
            tbody.innerHTML+=`
                <tr>
                    <td><strong>${app.appId}</strong></td>
                    <td>${app.applicantName}</td>
                    <td>${app.propertyAddress}</td>
                    <td>${app.appType}</td>
                    <td>${new Date(app.submitDate).toLocaleDateString()}<br><small>${days} days ago</small></td>
                    <td><span class="workflow-stage">${app.currentStage}</span></td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td><button class="btn btn-secondary" style="padding:8px 16px;font-size:12px;" onclick="viewApplication(${app.id})">View</button></td>
                </tr>
            `;
        });
        updateStats();
    }

    function updateStats(){
        document.getElementById('total-applications').textContent=applications.length;
        document.getElementById('pending-review').textContent=applications.filter(a=>a.status==='review').length;
        document.getElementById('approved-month').textContent=applications.filter(a=>a.status==='approved').length;
    }

    function filterApplications(){
        const term=document.getElementById('search-input').value.toLowerCase();
        const status=document.getElementById('filter-status').value;
        renderApplications(applications.filter(a=>(a.applicantName.toLowerCase().includes(term)||a.propertyAddress.toLowerCase().includes(term)||a.appId.toLowerCase().includes(term))&&(status==='all'||a.status===status)));
    }

    function showNewApplicationModal(){ document.getElementById('new-application-modal').classList.add('active'); }
    function closeModal(){ document.getElementById('new-application-modal').classList.remove('active'); }

    function submitApplication(e){
        e.preventDefault();
        const newApp={
            id:applications.length+1,
            appId:document.getElementById('app-id').value,
            applicantName:document.getElementById('applicant-name').value,
            propertyAddress:document.getElementById('property-address').value,
            appType:document.getElementById('app-type').value,
            description:document.getElementById('description').value,
            submitDate:document.getElementById('submit-date').value,
            status:'submitted',
            currentStage:'Initial Review',
            contactEmail:document.getElementById('contact-email').value
        };
        applications.push(newApp);
        localStorage.setItem('planning_applications',JSON.stringify(applications));
        renderApplications();
        closeModal();
        e.target.reset();
        alert('âœ… Planning application submitted successfully!\nApplication ID: '+newApp.appId);
    }

    function viewApplication(id){
        const app=applications.find(a=>a.id===id);
        alert(`Application Details:\n\nID: ${app.appId}\nApplicant: ${app.applicantName}\nProperty: ${app.propertyAddress}\nType: ${app.appType}\nStatus: ${app.status}\nCurrent Stage: ${app.currentStage}\n\nDescription: ${app.description}`);
    }

    function trackApplication(){
        const trackingId=document.getElementById('tracking-id').value.toUpperCase();
        const app=applications.find(a=>a.appId.toUpperCase()===trackingId);
        const div=document.getElementById('tracking-result');
        if(app){
            const days=calculateDaysSince(app.submitDate);
            div.innerHTML=`<div style="background:white;padding:30px;border-radius:15px;box-shadow:0 4px 12px rgba(0,0,0,0.1);">
                <h3 style="color:#dc2626;margin-bottom:20px;">Application Found: ${app.appId}</h3>
                <div style="text-align:left;max-width:500px;margin:0 auto;">
                    <p><strong>Applicant:</strong> ${app.applicantName}</p>
                    <p><strong>Property:</strong> ${app.propertyAddress}</p>
                    <p><strong>Type:</strong> ${app.appType}</p>
                    <p><strong>Submitted:</strong> ${new Date(app.submitDate).toLocaleDateString()} (${days} days ago)</p>
                    <p><strong>Current Stage:</strong> <span class="workflow-stage">${app.currentStage}</span></p>
                    <p><strong>Status:</strong> <span class="status-badge status-${app.status}">${app.status}</span></p>
                </div></div>`;
        } else {
            div.innerHTML=`<div style="background:#fee2e2;padding:20px;border-radius:10px;color:#991b1b;"><strong>Application not found.</strong><br>Please check your Application ID and try again.</div>`;
        }
    }

    function showTab(tabName, evt){
        document.querySelectorAll('[id$="-tab"]').forEach(tab=>tab.classList.add('hidden'));
        document.getElementById(tabName+'-tab').classList.remove('hidden');
        document.querySelectorAll('.nav-tab').forEach(btn=>btn.classList.remove('active'));
        if(evt) evt.currentTarget.classList.add('active');
    }

    // Initialize
    renderApplications();
</script>
```

</body>
</html>
